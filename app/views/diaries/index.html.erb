<%= render "shared/app_header" %>

<div class="diary-page-container">
  <div class="diary-welcome">
    <div class="diary-welcome__text text-center">
      <h1 class="diary-welcome__title">Bienvenue dans ton journal</h1>
      <p class="diary-welcome__text">
        Ici, tu peux écrire librement, documenter ton parcours et célébrer chaque étape.
      </p>
    </div>
  </div>

  <%= link_to new_diary_path, class: "diary-new-entry-btn" do %>
    Nouvelle entrée
  <% end %>

  <div class="diary-section-header">
    <h2 class="diary-section-header__title">Tes entrées récentes</h2>
  </div>

  <div class="diary-page-grid">
    <% @diaries.each do |diary| %>
      <div class="diary-page-card">
        <p class="diary-page-card__date"><%= l(diary.created_at, format: :long) %></p>

        <h3 class="diary-page-card__title">
          <%= link_to diary.title, diary_path(diary) %>
        </h3>

        <p class="diary-page-card__excerpt">
          <% cleaned = diary.content.to_plain_text.gsub(/\[[^\]]+\]/, "") %>
          <%= truncate(cleaned.squish, length: 100) %>
        </p>

        <div class="diary-page-card__footer">
          <%= link_to "Modifier", edit_diary_path(diary), class: "diary-page-card__action" %>
          <%= link_to "Supprimer", diary_path(diary),
                data: { turbo_method: :delete, turbo_confirm: "Supprimer ce journal ?" },
                class: "diary-page-card__action diary-page-card__action--danger" %>
        </div>
      </div>
    <% end %>
  </div>
</div>



<%# modif après la ligne 30, avant code : <%= truncate(diary.content.to_plain_text, length: 100)%>
<%# avant : affichage du nom de la photo dans la preview du journal car diary.content.to_plain_text = [photo]
après : grâce à regex, remplace ce qu'il y a entre [] par du vide
truncate length: 100 = coupe le texte pour la preview à max 100 caractères %>
