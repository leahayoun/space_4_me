<div class="diary-page-container" data-controller="delete-modal">
  <div class="diary-welcome">
    <div class="diary-welcome__text text-center">
      <h1 class="diary-welcome__title">Bienvenue dans ton journal</h1>
      <p class="diary-welcome__text">
        Ici, tu peux écrire librement, documenter ton parcours et célébrer chaque étape.
      </p>
    </div>
  </div>

  <%= link_to new_diary_path, class: "diary-new-entry-btn" do %>
    Nouvelle entrée
  <% end %>

  <div class="diary-section-header">
    <h2 class="diary-section-header__title">Tes entrées récentes</h2>
  </div>

    <% if @diaries.any? %>
      <% @diaries.each do |diary| %>
      <% end %>
    <% else %>
      <p class="diary-empty-message">
        Il n'y a pas encore d'entrée.
      </p>
    <% end %>

  <div class="diary-page-grid">
    <% @diaries.each do |diary| %>
      <div class="diary-page-card">
        <p class="diary-page-card__date"><%= l(diary.created_at, format: :long) %></p>

        <h3 class="diary-page-card__title">
          <%= link_to diary.title, diary_path(diary) %>
        </h3>

        <p class="diary-page-card__excerpt">
          <% cleaned = diary.content.to_plain_text.gsub(/\[[^\]]+\]/, "") %>
          <%= truncate(cleaned.squish, length: 100) %>
        </p>

        <div class="diary-page-card__footer">
          <%= link_to "Modifier", edit_diary_path(diary), class: "diary-page-card__action" %>
          <%= link_to "Supprimer", "#",
                class: "diary-page-card__action diary-page-card__action--danger",
                data: {
                  action: "click->delete-modal#open",
                  delete_url: diary_path(diary),
                  appointment_title: diary.title
                } %>
        </div>
      </div>
    <% end %>
  </div>

  <!-- Delete Confirmation Modal -->
  <div data-delete-modal-target="overlay"
       data-action="click->delete-modal#closeOnOverlay"
       class="delete-modal-overlay">
    <div class="delete-modal">
      <div class="delete-modal-icon">
        <i class="fas fa-trash-alt"></i>
      </div>
      <h3 class="delete-modal-title">Supprimer cette entrée ?</h3>
      <p class="delete-modal-text">
        <span data-delete-modal-target="eventName"></span>
      </p>
      <p class="delete-modal-warning">Cette action est irréversible.</p>
      <div class="delete-modal-actions">
        <button type="button"
                class="delete-modal-btn delete-modal-cancel"
                data-action="click->delete-modal#close">
          Annuler
        </button>
        <%= form_tag "", method: :delete, data: { delete_modal_target: "form" }, class: "delete-modal-form" do %>
          <button type="submit" class="delete-modal-btn delete-modal-confirm">
            Supprimer
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>


<%# modif après la ligne 30, avant code : <%= truncate(diary.content.to_plain_text, length: 100)%>
<%# avant : affichage du nom de la photo dans la preview du journal car diary.content.to_plain_text = [photo]
après : grâce à regex, remplace ce qu'il y a entre [] par du vide
truncate length: 100 = coupe le texte pour la preview à max 100 caractères %>
