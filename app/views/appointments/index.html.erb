<div class="mobile-dashboard" data-controller="delete-modal">
  <!-- back btn -->
  <div class="btn-back">
    <%= link_to dashboard_path, class: "btn-link border-0 ps-2" do %>
      <i class="fas fa-arrow-left me-2"></i>
      Dashboard
    <% end %>
  </div>

  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>
      <i class="fas fa-calendar-alt me-2"></i>
      Evènements
    </h1>

    <%= link_to new_appointment_path, class: "btn btn-primary" do %>
      <i class="fas fa-plus me-2"></i>
      Nouveau
    <% end %>
  </div>

<%# events filters %>
  <div class="appointments-filters mb-4">
    <ul class="appointments-filter-tabs">
      <li class="filter-tab-item">
        <%= link_to "À venir", appointments_path(filter: 'upcoming'),
                    class: "filter-tab-link #{'active' if @filter == 'upcoming'}" %>
      </li>
      <li class="filter-tab-item">
        <%= link_to "Passés", appointments_path(filter: 'past'),
                    class: "filter-tab-link #{'active' if @filter == 'past'}" %>
      </li>
      <li class="filter-tab-item">
        <%= link_to "Tous", appointments_path(filter: 'all'),
                    class: "filter-tab-link #{'active' if @filter == 'all'}" %>
      </li>
    </ul>
  </div>


  <% if @appointments.any? %>
    <div class="row">
      <% @appointments.each do |appointment| %>
        <div class="col-12 mb-3">
          <%= link_to appointment_path(appointment), class: "appointment-card-link" do %>
            <div class="appointment-list-card card">
              <!-- Action icons (top right) -->
              <div class="appointment-card-icons" onclick="event.stopPropagation();">
                <%= link_to appointment_path(appointment), class: "appointment-icon-btn appointment-icon-view", title: "Voir", onclick: "event.stopPropagation();" do %>
                  <i class="fas fa-eye"></i>
                <% end %>
                <%= link_to edit_appointment_path(appointment), class: "appointment-icon-btn appointment-icon-edit", title: "Modifier", onclick: "event.stopPropagation();" do %>
                  <i class="fas fa-pen"></i>
                <% end %>
                <button type="button"
                        class="appointment-icon-btn appointment-icon-delete"
                        data-action="click->delete-modal#open"
                        data-delete-url="<%= appointment_path(appointment) %>"
                        data-appointment-title="<%= appointment.title %>"
                        title="Supprimer"
                        onclick="event.stopPropagation();">
                  <i class="fas fa-times"></i>
                </button>
              </div>

              <div class="card-body">
                <!-- Title + Badge row -->
                <div class="appointment-card-header">
                  <h5 class="card-title">
                    <%= appointment.title %>
                  </h5>
                  <% if appointment.event_type.present? %>
                    <span class="badge bg-secondary">
                      <%= appointment.event_type %>
                    </span>
                  <% end %>
                </div>

                <!-- Double line decoration -->
                <div class="appointment-title-decoration"></div>

                <!-- Date & Address -->
                <div class="appointment-card-details">
                  <div class="text-muted small">
                    <i class="fas fa-calendar-day me-1"></i>
                    <%= l(appointment.date, format: :long) %>
                  </div>

                  <% if appointment.address.present? %>
                    <div class="text-muted small">
                      <i class="fas fa-map-marker-alt me-1"></i>
                      <%= truncate(appointment.address, length: 50) %>
                    </div>
                  <% end %>
                </div>

                <!-- Notes preview -->
                <% if appointment.content.present? %>
                  <div class="appointment-notes-preview">
                    <i class="fas fa-sticky-note me-1"></i>
                    <%= truncate(appointment.content, length: 80) %>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="text-center py-5">
      <i class="fas fa-calendar-plus fa-3x text-muted mb-3"></i>
      <h3>Aucun événement</h3>
      <p class="text-muted">Ajoutez votre premier événement</p>
      <%#= link_to "+ Nouvel événement", new_appointment_path, class: "btn btn-primary mt-3" %>
    </div>
  <% end %>

  <!-- Delete Confirmation Modal -->
  <div data-delete-modal-target="overlay"
       data-action="click->delete-modal#closeOnOverlay"
       class="delete-modal-overlay">
    <div class="delete-modal">
      <div class="delete-modal-icon">
        <i class="fas fa-trash-alt"></i>
      </div>
      <h3 class="delete-modal-title">Supprimer cet événement ?</h3>
      <p class="delete-modal-text">
        <span data-delete-modal-target="eventName"></span>
      </p>
      <p class="delete-modal-warning">Cette action est irréversible.</p>
      <div class="delete-modal-actions">
        <button type="button"
                class="delete-modal-btn delete-modal-cancel"
                data-action="click->delete-modal#close">
          Annuler
        </button>
        <%= form_tag "", method: :delete, data: { delete_modal_target: "form" }, class: "delete-modal-form" do %>
          <button type="submit" class="delete-modal-btn delete-modal-confirm">
            Supprimer
          </button>
        <% end %>
      </div>
    </div>
  </div>
</div>
