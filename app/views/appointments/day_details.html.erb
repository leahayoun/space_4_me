<%# app/views/appointments/day_details.html.erb %>
<%# Version: avec support de start_time %>

<div class="day-details-container">
  <!-- Bouton retour -->
  <div class="btn-back">
    <%= link_to dashboard_path, class: "btn-link border-0 ps-2" do %>
      <i class="fas fa-arrow-left me-2"></i>
      Calendrier
    <% end %>
  </div>

  <!-- Card principale -->
  <div class="dashboard-section day-details-card">
    <!-- Header: titre + date + bouton ajouter -->
    <div class="day-details-header">
      <div>
        <h1 class="day-details-title">
          <i class="fas fa-calendar-day me-2"></i>
          Détails du jour
        </h1>
        <p class="day-details-date">
          <%= l(@date, format: :long) %>
          <% if @date == Date.today %>
            <span class="badge bg-today ms-2">Aujourd'hui</span>
          <% end %>
        </p>
      </div>

      <%= link_to new_appointment_path(date: @date),
                  class: "btn btn-add-event" do %>
        <i class="fas fa-plus me-2"></i>
        Ajouter
      <% end %>
    </div>

    <!-- Section titre événements -->
    <div class="day-details-events-header">
      <h5>
        <i class="fas fa-calendar-alt me-2"></i>
        Événements du jour
        <span class="badge bg-count"><%= @appointments.count %></span>
      </h5>
    </div>

    <!-- Liste des événements -->
    <% if @appointments.any? %>
      <div class="day-details-events-list">
        <% @appointments.each do |appointment| %>
          <div class="day-details-event-card">
            <!-- Top row: badge + icon buttons -->
            <div class="day-details-event-top">
              <% if appointment.event_type.present? %>
                <span class="badge bg-event-type">
                  <%= appointment.event_type %>
                </span>
              <% end %>

              <div class="appointment-card-icons">
                <%= link_to appointment_path(appointment), class: "appointment-icon-btn appointment-icon-view-green", title: "Voir" do %>
                  <i class="fas fa-eye"></i>
                <% end %>
                <%= link_to edit_appointment_path(appointment), class: "appointment-icon-btn appointment-icon-edit-green", title: "Modifier" do %>
                  <i class="fas fa-pen"></i>
                <% end %>
              </div>
            </div>

            <!-- Event content (clickable) -->
            <%= link_to appointment_path(appointment), class: "day-details-event-link" do %>
              <h6 class="day-details-event-title"><%= appointment.title %></h6>

              <div class="day-details-event-info">
                <span>
                  <i class="fas fa-calendar-day me-1"></i>
                  <%= l(appointment.date, format: :long) %>
                </span>

                <% if appointment.start_time.present? %>
                  <span>
                    <i class="fas fa-clock me-1"></i>
                    <%= appointment.start_time.strftime('%H:%M') %>
                  </span>
                <% end %>
              </div>

              <% if appointment.address.present? %>
                <p class="day-details-event-address">
                  <i class="fas fa-map-marker-alt me-1"></i>
                  <%= appointment.address %>
                </p>
              <% end %>

              <% if appointment.content.present? %>
                <p class="day-details-event-notes">
                  <%= truncate(appointment.content, length: 150) %>
                </p>
              <% end %>
            <% end %>
          </div>
        <% end %>
      </div>
    <% else %>
      <!-- Aucun événement -->
      <div class="day-details-empty">
        <i class="fas fa-calendar-times"></i>
        <h5>Aucun événement ce jour</h5>
        <%# <p>Ajoutez votre premier événement</p> %>
      </div>
    <% end %>
  </div>
</div>
