<%= form_for @user, url: wizard_path, method: :put, html: { class: "onboarding-form" } do |f| %>

<h2>Informations sur le traitement hormonal</h2>

  <p>
    <%= f.label :hormonal_treatment_status, "Prennez-vous actuellement un traitement hormonal ?" %><br>
    <%= f.select :hormonal_treatment_status,
          ["Oui, j'ai déjà commencé", "Non, mais je compte commencer", "Non, je ne veux pas de THS", "Je veux m'informer"],
          {},
          { id: "hormonal_status_select" } %>
  </p>

  <!-- Bloc FTM -->
  <div id="ftm_block" style="display:none;">
    <h3>Traitements hormonaux masculinisants</h3>
    <p>
      <label><%= f.check_box :treatment_androtardyl %> Androtardyl (Injection)</label><br>
      <label><%= f.check_box :treatment_nebido %> Nebido (Injection)</label><br>
    </p>
  </div>

   <!-- Bloc MTF -->
  <div id="mtf_block" style="display:none;">
    <h3>Traitements hormonaux féminisants</h3>
    <strong>Anti-androgènes et progestatifs :</strong><br>
    <p>
      <label><%= f.check_box :treatment_bicalutamide %> Bicalutamide</label><br>
      <label><%= f.check_box :treatment_decapeptyl %> Décapeptyl</label><br>
      <label><%= f.check_box :treatment_lupron %> Lupron</label><br>
      <label><%= f.check_box :treatment_progesterone %> Progestérone</label><br>
    </p>
    <strong>Œstrogènes :</strong><br>
    <p>
      <label><%= f.check_box :treatment_estreva %> Estreva (gel)</label><br>
      <label><%= f.check_box :treatment_oestrodose %> Œstrodose (gel)</label><br>
      <label><%= f.check_box :treatment_oesclim %> Oesclim (patch)</label><br>
      <label><%= f.check_box :treatment_dermestril %> Dermestril (patch)</label><br>
      <label><%= f.check_box :treatment_provames %> Provames (comprimés)</label><br>
      <label><%= f.check_box :treatment_estrofem %> Estrofem (comprimés)</label><br>
      <label><%= f.check_box :treatment_progynova %> Progynova (comprimés)</label><br>
      <label><%= f.check_box :treatment_neofollin %> Neofollin (Injection)</label><br>
      <label><%= f.check_box :treatment_gynodian %> Gynodian Depot (Injection)</label><br>
    </p>
  </div>

  <div class="actions">
    <%= link_to "Retour", previous_wizard_path, class: "btn home-btn-secondary" %>
    <%= f.submit "Suivant", class: "btn home-btn-primary" %>
  </div>

<% end %>

<!-- Data attributes pour le JS -->
<div id="hormonal_data" data-birth-sex="<%= @user.birth_sex %>" data-gender="<%= @user.gender %>"></div>

<script>
document.addEventListener("turbo:load", () => {
  const statusSelect = document.getElementById("hormonal_status_select");
  const ftmBlock = document.getElementById("ftm_block");
  const mtfBlock = document.getElementById("mtf_block");

  const dataDiv = document.getElementById("hormonal_data");
  const birthSex = dataDiv.dataset.birthSex;
  const gender = dataDiv.dataset.gender;

  function toggleBlocks() {
    const value = statusSelect.value;
    ftmBlock.style.display = "none";
    mtfBlock.style.display = "none";

    if (value === "Oui, j'ai déjà commencé" || value === "Non, mais je compte commencer") {
      if (birthSex === "XX") ftmBlock.style.display = "block";
      else if (birthSex === "XY") mtfBlock.style.display = "block";
      else {
        if (gender === "Homme") ftmBlock.style.display = "block";
        if (gender === "Femme") mtfBlock.style.display = "block";
      }
    }
  }

  statusSelect.addEventListener("change", toggleBlocks);
  toggleBlocks(); // initial
});
</script>
