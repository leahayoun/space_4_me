<h2>Informations sur le traitement hormonal</h2>

<%= form_for @user, url: wizard_path, method: :put do |f| %>
  <p>
    <%= f.label :hormonal_treatment_status, "Prennez-vous actuellement un traitement hormonal ?" %><br>
    <%= f.select :hormonal_treatment_status, ["Oui, j'ai déjà commencé", "Non, mais je compte commencer", "Non, je ne veux pas de THS",  "Je veux m'informer"] %>
  </p>

  <!-- Bloc FTM / FTX -->
  <div id="ftm_treatments" style="display:none;">
    <h3>Traitements hormonaux masculinisants</h3>
    <p> Quel est votre traitement ? </p>
    <label><%= f.check_box :treatment_androtardyl %> Androtardyl</label><br>
    <label><%= f.check_box :treatment_nebido %> Nebido</label><br>
  </div>

  <!-- Bloc MTF / MTX -->
  <div id="mtf_treatments" style="display:none;">
    <h3>Traitements hormonaux féminisants</h3>
    <p> Quel est votre traitement ?</p>

    <strong>Anti-androgènes et progestatifs :</strong><br>
    <label><%= f.check_box :treatment_bicalutamide %> Bicalutamide</label><br>
    <label><%= f.check_box :treatment_decapeptyl %> Décapeptyl, Lupron et bloqueurs de puberté</label><br>
    <label><%= f.check_box :treatment_progesterone %> Progestérone</label><br>

    <strong>Œstrogènes :</strong><br>
    <label><%= f.check_box :treatment_estreva %> Estreva (gel)</label><br>
    <label><%= f.check_box :treatment_oestrodose %> Œstrodose (gel)</label><br>
    <label><%= f.check_box :treatment_oesclim %> Oesclim (patch)</label><br>
    <label><%= f.check_box :treatment_dermestril %> Dermestril (patch)</label><br>
    <label><%= f.check_box :treatment_provames %> Provames (comprimés)</label><br>
    <label><%= f.check_box :treatment_estrofem %> Estrofem (comprimés)</label><br>
    <label><%= f.check_box :treatment_progynova %> Progynova (comprimés)</label><br>
    <label><%= f.check_box :treatment_neofollin %> Neofollin (Injection)</label><br>
    <label><%= f.check_box :treatment_gynodian %> Gynodian Depot (Injection)</label><br>
  </div>

  <%= f.submit "Next" %>
<% end %>

  <script>
  document.addEventListener("DOMContentLoaded", () => {
    const birthSex = "<%= @user.birth_sex %>";
    const gender = "<%= @user.gender %>";
    const hormonalStatus = document.getElementById("hormonal_status");
    const ftmBlock = document.getElementById("ftm_treatments");
    const mtfBlock = document.getElementById("mtf_treatments");

    function toggleTreatmentBlocks() {
      // Cacher les deux blocs par défaut
      ftmBlock.style.display = "none";
      mtfBlock.style.display = "none";

      // Si l'utilisateur a commencé ou compte commencer un traitement
      if (hormonalStatus.value === "Oui, j'ai déjà commencé" ||
          hormonalStatus.value === "Non, mais je compte commencer") {

        if (birthSex === "XX") {
          ftmBlock.style.display = "block"; // bloc masculin
        } else if (birthSex === "XY") {
          mtfBlock.style.display = "block"; // bloc féminin
        } else {
          if (gender === "Homme") {
            ftmBlock.style.display = "block";
          } else if (gender === "Femme") {
            mtfBlock.style.display = "block";
          }
        }
      }
      // Sinon ("Je veux m'informer" ou autre) : les blocs restent cachés
    }

    hormonalStatus.addEventListener("change", toggleTreatmentBlocks);
    toggleTreatmentBlocks(); // initialisation au chargement
  });
</script>

